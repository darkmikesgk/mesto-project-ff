(()=>{"use strict";function e(e,t,o,r,c,i,u,a,s){var l=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),d=l.querySelector(".card__image"),p=l.querySelector(".card__title"),_=l.querySelector(".card__like-button_counter-style"),f=l.querySelector(".card__like-button"),m=l.querySelector(".card__delete-button");return d.src=e.link,d.atl=e.name,p.textContent=e.name,_.textContent=e.likes.length,d.addEventListener("click",(function(){u(e.link,e.name)})),function(e,t,n){t.likes.some((function(t){return t._id===e}))&&n.classList.add("card__like-button_is-active")}(t,e,f),n(_),f.addEventListener("click",(function(){var t=f.classList.contains("card__like-button_is-active");t?t&&s(e._id).then((function(e){o(e,f,_),n(_)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ".concat(e))})):a(e._id).then((function(e){o(e,f,_),n(_)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ".concat(e))}))})),t===e.owner._id?m.addEventListener("click",(function(){i(e._id,l)})):m.remove(),l}function t(e,t,o){var r=t.classList.contains("card__like-button_is-active"),c=parseInt(o.textContent),i=e.likes.length;!r&&c<i?t.classList.add("card__like-button_is-active"):r&&c>i&&t.classList.remove("card__like-button_is-active"),o.textContent=i,n(o)}function n(e){0===parseInt(e.textContent)?e.classList.add("card__like-button_counter-visible"):e.classList.remove("card__like-button_counter-visible")}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c),e.addEventListener("click",i)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),e.removeEventListener("click",i)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function i(e){e.target===e.currentTarget&&r(e.target)}var u=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_disabled")):(t.disabled=!0,t.classList.add("popup__button_disabled"))};var a="https://mesto.nomoreparties.co/v1/wff-cohort-8/",s="dd6cce3f-a27e-4c09-af7d-93c6a1fea6ca",l=function(e){return fetch(a+"cards/likes/".concat(e),{method:"PUT",headers:{authorization:s}}).then((function(e){return p(e)}))},d=function(e){return fetch(a+"cards/likes/".concat(e),{method:"DELETE",headers:{authorization:s}}).then((function(e){return p(e)}))};function p(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}var _,f,m=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_avatar"),b=document.querySelector(".popup_type_delete_card"),S=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),k=document.querySelector(".popup__button_save-profile"),q=document.querySelector(".popup__button_add-card"),C=document.querySelector(".popup__button_change-avatar"),E=document.querySelector(".popup__image"),g=document.querySelector(".popup__caption"),x=document.querySelector(".places__list"),P=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),z=document.querySelector(".profile__image"),A=document.querySelectorAll(".popup"),D=document.querySelectorAll(".popup__close"),w=document.forms["edit-profile"],j=w.querySelector(".popup__input_type_name"),I=w.querySelector(".popup__input_type_description"),N=document.forms["new-place"],O=N.elements["place-name"],B=N.elements.link,J=document.forms["change-avatar"],M=J.elements["link-avatar"];function H(e,t){o(b);var n=document.forms["delete-card"];n.handleSubmitConfirmPopup&&n.removeEventListener("submit",n.handleSubmitConfirmPopup),n.handleSubmitConfirmPopup=function(n){var o;n.preventDefault(),(o=e,fetch(a+"cards/".concat(o),{method:"DELETE",headers:{authorization:s}}).then((function(e){return p(e)}))).then((function(){t.remove(),r(b)})).catch((function(e){F(e)}))},n.addEventListener("submit",n.handleSubmitConfirmPopup)}function V(e,t){E.src=e,E.alt=t,g.textContent=t,h.classList.add("popup__dark"),o(h)}function U(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function F(e){console.log("Ошибка. Запрос не выполнен: ".concat(e))}D.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return r(t)}))})),S.addEventListener("click",(function(){o(m)})),L.addEventListener("click",(function(){o(v)})),z.addEventListener("click",(function(){o(y)})),Promise.all([fetch(a+"users/me",{headers:{authorization:s}}).then((function(e){return p(e)})),fetch(a+"cards",{headers:{authorization:s}}).then((function(e){return p(e)}))]).then((function(n){P.textContent=n[0].name,T.textContent=n[0].about,j.value=P.textContent,I.value=T.textContent,z.style.backgroundImage="url(".concat(n[0].avatar,")"),_=n[0]._id,n[1].forEach((function(n){x.append(e(n,_,t,0,0,H,V,l,d))}))})).catch((function(e){F(e)})),f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(f.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);u(n,o),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.textContent="",n.classList.remove("popup__error_visible")}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__error-visible")}(e,t,t.validationMessage)}(e,t),u(n,o)}))}))}(e,f)})),A.forEach((function(e){e.classList.add("popup_is-animated")})),N.addEventListener("submit",(function(n){var o,c;n.preventDefault(),U(!0,q),(o=O.value,c=B.value,fetch(a+"cards",{method:"POST",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:c})}).then((function(e){return p(e)}))).then((function(n){x.prepend(e(n,_,t,0,0,H,V,l,d)),r(v),N.reset()})).catch((function(e){F(e)})).finally((function(){U(!1,q)}))})),w.addEventListener("submit",(function(e){var t,n;e.preventDefault(),U(!0,k),(t=j.value,n=I.value,fetch(a+"users/me",{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return p(e)}))).then((function(e){P.textContent=e.name,T.textContent=e.about,j.value=P.textContent,I.value=T.textContent,r(m)})).catch((function(e){F(e)})).finally((function(){U(!1,k)}))})),J.addEventListener("submit",(function(e){var t;e.preventDefault(),U(!0,C),(t=M.value,fetch(a+"users/me/avatar",{method:"PATCH",headers:{authorization:s,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return p(e)}))).then((function(e){M.value=e.avatar,z.style.backgroundImage="url(".concat(M.value,")"),r(y)})).catch((function(e){F(e)})).finally((function(){U(!1,C)}))}))})();