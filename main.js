(()=>{"use strict";function e(e,t,o,r,c,i,u,a,l){var s=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),d=s.querySelector(".card__image"),p=s.querySelector(".card__title"),_=s.querySelector(".card__like-button_counter-style"),f=s.querySelector(".card__like-button"),m=s.querySelector(".card__delete-button");return d.src=e.link,d.atl=e.name,p.textContent=e.name,_.textContent=e.likes.length,d.addEventListener("click",(function(){u(e.link,e.name)})),function(e,t,n){t.likes.some((function(t){return t._id===e}))&&n.classList.add("card__like-button_is-active")}(t,e,f),n(_),f.addEventListener("click",(function(){o(e,f,_),parseInt(_.textContent)>e.likes.length?a(e._id):parseInt(_.textContent)<=e.likes.length&&l(e._id)})),t===e.owner._id?m.addEventListener("click",(function(){i(e._id,s)})):m.remove(),s}function t(e,t,o){t.classList.contains("card__like-button_is-active")?(t.classList.remove("card__like-button_is-active"),parseInt(o.textContent)>0&&(o.textContent--,n(o))):(t.classList.add("card__like-button_is-active"),parseInt(o.textContent)<=e.likes.length&&(o.textContent++,n(o)))}function n(e){0===parseInt(e.textContent)?e.classList.add("card__like-button_counter-visible"):e.classList.remove("card__like-button_counter-visible")}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c),e.addEventListener("click",i)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),e.removeEventListener("click",i)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function i(e){e.target===e.currentTarget&&r(document.querySelector(".popup_is-opened"))}var u=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(n,o),n.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.textContent="",n.classList.remove("popup__error_visible")}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__error-visible")}(e,t,t.validationMessage)}(e,t),l(n,o)}))}))},a=function(e,t){Array.from(e.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),u(e,t)}))},l=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_disabled")):(t.disabled=!0,t.classList.add("popup__button_disabled"))},s="https://mesto.nomoreparties.co/v1/wff-cohort-8/",d="dd6cce3f-a27e-4c09-af7d-93c6a1fea6ca",p=function(e){return fetch(s+"cards/likes/".concat(e),{method:"PUT",headers:{authorization:d}}).then((function(e){return f(e)})).catch((function(e){m(e)}))},_=function(e){return fetch(s+"cards/likes/".concat(e),{method:"DELETE",headers:{authorization:d}}).then((function(e){return f(e)})).catch((function(e){m(e)}))};function f(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}function m(e){console.log("Ошибка. Запрос не выполнен: ".concat(e))}var v,y=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=document.querySelector(".popup_type_avatar"),L=document.querySelector(".popup_type_delete_card"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),C=y.querySelector(".popup__close"),E=h.querySelector(".popup__close"),g=b.querySelector(".popup__close"),x=S.querySelector(".popup__close"),P=L.querySelector(".popup__close"),T=document.querySelector(".popup__button_save-profile"),z=document.querySelector(".popup__button_add-card"),A=document.querySelector(".popup__button_change-avatar"),D=document.querySelector(".popup__image"),I=document.querySelector(".popup__caption"),w=document.querySelector(".places__list"),j=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),O=document.querySelector(".profile__image"),B=document.querySelectorAll(".popup"),J=document.forms["edit-profile"],M=J.querySelector(".popup__input_type_name"),H=J.querySelector(".popup__input_type_description"),V=document.forms["new-place"],U=V.elements["place-name"],F=V.elements.link,G=document.forms["change-avatar"],K=G.elements["link-avatar"],Q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function R(e,t){o(L);var n=document.forms["delete-card"];n.handleSubmitConfirmPopup&&n.removeEventListener("submit",n.handleSubmitConfirmPopup),n.handleSubmitConfirmPopup=function(n){n.preventDefault(),fetch(s+"cards/".concat(e),{method:"DELETE",headers:{authorization:d}}).then((function(e){return f(e)})).catch((function(e){m(e)})),t.remove(),r(L)},n.addEventListener("submit",n.handleSubmitConfirmPopup)}function W(e,t){D.src=e,D.alt=t,I.textContent=t,b.classList.add("popup__dark"),o(b)}function X(e,t){t.textContent=e?"Сохранение...":"Сохранить"}k.addEventListener("click",(function(){o(y),a(y,Q),u(y,Q),M.value===j.textContent&&H.value===N.textContent&&(T.setAttribute("disabled",!0),T.classList.add("popup__button_disabled"))})),q.addEventListener("click",(function(){o(h),a(h,Q),u(h,Q)})),O.addEventListener("click",(function(){o(S),a(S,Q),u(S,Q)})),C.addEventListener("click",(function(){r(y),J.reset()})),E.addEventListener("click",(function(){r(h)})),g.addEventListener("click",(function(){r(b)})),x.addEventListener("click",(function(){r(S)})),P.addEventListener("click",(function(){r(L)})),Promise.all([fetch(s+"users/me",{headers:{authorization:d}}).then((function(e){return f(e)})).catch((function(e){m(e)})),fetch(s+"cards",{headers:{authorization:d}}).then((function(e){return f(e)})).catch((function(e){m(e)}))]).then((function(n){j.textContent=n[0].name,N.textContent=n[0].about,M.value=j.textContent,H.value=N.textContent,O.style.backgroundImage="url(".concat(n[0].avatar,")"),v=n[0]._id,n[1].forEach((function(n){w.append(e(n,v,t,0,0,R,W,p,_))}))})),B.forEach((function(e){e.classList.add("popup_is-animated")})),V.addEventListener("submit",(function(n){var o,c;n.preventDefault(),X(!0,z),(o=U.value,c=F.value,fetch(s+"cards",{method:"POST",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:c})}).then((function(e){return f(e)})).catch((function(e){m(e)}))).then((function(n){w.prepend(e(n,v,t,0,0,R,W,p,_))})).finally((function(){X(!1,z)})),r(h),V.reset()})),J.addEventListener("submit",(function(e){var t,n;e.preventDefault(),X(!0,T),(t=M.value,n=H.value,fetch(s+"users/me",{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return f(e)})).catch((function(e){m(e)}))).then((function(e){j.textContent=e.name,N.textContent=e.about,M.value=j.textContent,H.value=N.textContent})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ".concat(e))})).finally((function(){X(!1,T)})),r(y)})),G.addEventListener("submit",(function(e){var t;e.preventDefault(),X(!0,A),(t=K.value,fetch(s+"users/me/avatar",{method:"PATCH",headers:{authorization:d,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return f(e)})).catch((function(e){m(e)}))).then((function(e){K.value=e.avatar,O.style.backgroundImage="url(".concat(K.value,")")})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ".concat(e))})).finally((function(){X(!1,A)})),r(S)}))})();